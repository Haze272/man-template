<section class="page">
  <h1 class="aurora">Список бронирований</h1>

  @let books = bookings$ | async;

  @if (books) {
    <p-table
      [value]="books"
      [tableStyle]="{ 'min-width': '50rem' }"
      [paginator]="true"
      [rows]="20"
      [rowsPerPageOptions]="[20, 50, 100]"
    >
      <ng-template #header>
        <tr>
          <th>ID</th>
          <th>Период</th>
          <th>Дата бронирование</th>
          <th>Персон</th>
          <th>Статус</th>
          <th>Пользователь</th>
          <th>Комната</th>
          <th>Итоговая стоимость</th>
          <th>
            Действия
            <p-button (click)="refreshList()" icon="pi pi-refresh" [rounded]="true" [text]="true" />
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-book>
        <tr>
          <td>{{ book.id }}</td>
          <td>{{ book.dateStart | date : 'dd.MM.yyyy' }} - {{ book.dateEnd | date : 'dd.MM.yyyy' }}</td>
          <td>{{ book.date | date : 'dd.MM.yyyy HH:mm:ss' }}</td>
          <td>{{ book.persons}}</td>
          <td>{{ book.bookStatus.name }}</td>
          <td>{{ book.user ? book.user.surname + ' ' + book.user.name[0] + '.' + book.user.patronymic[0] + '.' : 'N/A' }}</td>
          <td><a [routerLink]="['/book/rooms/', book.room.id]">{{ book.room.name }}</a></td>
          <td>
            {{ book.room.pricePerNight * book.persons * calculateNights(book.dateStart, book.dateEnd) }}
          </td>
          <td>
            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" (click)="openEditDialog(book.id)" title="Редактировать" />
            <p-button icon="pi pi-times" [rounded]="true" [text]="true" (click)="deleteBook(book.id)" title="Удалить" />
          </td>
        </tr>
      </ng-template>
    </p-table>
  } @else {
    net
  }
</section>
<p-dialog
  [header]="'Редактирование бронирования #' + editForm.controls['id'].value"
  [modal]="true"
  [(visible)]="editDialog"
  [style]="{ width: '800px' }"
>
  <div class="dialog">
    <form [formGroup]="editForm" (ngSubmit)="submitEdit()" class="dialog__form">
      <p-iftalabel>
        <p-date-picker
          [readonlyInput]="true"
          [showIcon]="true"
          formControlName="period"
          selectionMode="range"
          dateFormat="dd.mm.yy"
          inputId="period"
        />
        <label for="period">Период</label>
      </p-iftalabel>

      <p-iftalabel>
        <p-date-picker
          [readonlyInput]="true"
          [showIcon]="true"
          formControlName="date"
          dateFormat="dd.mm.yy"
          inputId="date"
          [disabled]="true"
        />
        <label for="date">Дата бронирования</label>
      </p-iftalabel>

      <p-iftalabel>
        <p-input-number inputId="persons" formControlName="persons"/>
        <label for="persons">Количество персон</label>
      </p-iftalabel>

      <p-iftalabel>
        <textarea id="comment" rows="5" cols="30" pTextarea formControlName="comment"></textarea>
        <label for="comment">Комментарий к бронированию</label>
      </p-iftalabel>

      <p-iftalabel>
        <p-input-number inputId="persons" formControlName="persons"/>
        <label for="persons">Спальных мест</label>
      </p-iftalabel>

      <p-iftalabel class="w-full md:w-56">
        <p-select
          formControlName="statusId"
          inputId="statusId"
          [options]="bookStatuses"
          optionLabel="name"
          optionValue="id"
          styleClass="w-full"
        />
        <label for="statusId">Статус бронирования</label>
      </p-iftalabel>

      <p-iftalabel class="w-full md:w-56">
        <p-select
          formControlName="userId"
          inputId="userId"
          [options]="users"
          optionLabel="email"
          optionValue="id"
          styleClass="w-full"
          [disabled]="true"
        />
        <label for="userId">Клиент</label>
      </p-iftalabel>

      <p-iftalabel class="w-full md:w-56">
        <p-select
          formControlName="roomId"
          inputId="roomId"
          [options]="rooms"
          optionLabel="name"
          optionValue="id"
          styleClass="w-full"
          [disabled]="true"
        />
        <label for="roomId">Комната</label>
      </p-iftalabel>

      <p-iftalabel>
        <p-input-number inputId="total" formControlName="total" [disabled]="true"/>
        <label for="total">Итоговая цена</label>
      </p-iftalabel>

    </form>

    <div class="dialog__actions">
      <p-button label="Cancel" severity="secondary" (click)="cancelEditDialog()" />
      <p-button label="Save" (click)="submitEdit()" />
    </div>
  </div>

</p-dialog>
